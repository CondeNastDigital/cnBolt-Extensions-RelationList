!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror",require("../xml/xml"))):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../xml/xml"],t):t(CodeMirror)}(function(t){"use strict";t.defineMode("markdown",function(e,n){function i(t,e,n){return e.f=e.inline=n,n(t,e)}function r(t,e,n){return e.f=e.block=n,n(t,e)}function a(t){return t.linkTitle=!1,t.em=!1,t.strong=!1,t.quote=0,v||t.f!=l||(t.f=c,t.block=o),t.trailingSpace=0,t.trailingSpaceNewLine=!1,t.thisLineHasContent=!1,null}function o(t,e){var a=t.sol(),o=!1!==e.list;!1!==e.list&&e.indentationDiff>=0?(e.indentationDiff<4&&(e.indentation-=e.indentationDiff),e.list=null):!1!==e.list&&e.indentation>0?(e.list=null,e.listDepth=Math.floor(e.indentation/4)):!1!==e.list&&(e.list=!1,e.listDepth=0);var l=null;if(e.indentationDiff>=4)return e.indentation-=4,t.skipToEnd(),q;if(t.eatSpace())return null;if(l=t.match(A))return e.header=l[0].length<=6?l[0].length:6,n.highlightFormatting&&(e.formatting="header"),e.f=e.inline,h(e);if(e.prevLineHasContent&&(l=t.match(P)))return e.header="="==l[0].charAt(0)?1:2,n.highlightFormatting&&(e.formatting="header"),e.f=e.inline,h(e);if(t.eat(">"))return e.indentation++,e.quote=a?1:e.quote+1,n.highlightFormatting&&(e.formatting="quote"),t.eatSpace(),h(e);if("["===t.peek())return i(t,e,d);if(t.match(W,!0))return T;if((!e.prevLineHasContent||o)&&(t.match(I,!1)||t.match(R,!1))){var f=null;return t.match(I,!0)?f="ul":(t.match(R,!0),f="ol"),e.indentation+=4,e.list=!0,e.listDepth++,n.taskLists&&t.match(U,!1)&&(e.taskList=!0),e.f=e.inline,n.highlightFormatting&&(e.formatting=["list","list-"+f]),h(e)}return n.fencedCodeBlocks&&t.match(/^```([\w+#]*)/,!0)?(e.localMode=b(RegExp.$1),e.localMode&&(e.localState=e.localMode.startState()),r(t,e,s),n.highlightFormatting&&(e.formatting="code-block"),e.code=!0,h(e)):i(t,e,e.inline)}function l(t,e){var n=S.token(t,e.htmlState);return(v&&null===e.htmlState.tagStart&&!e.htmlState.context||e.md_inside&&t.current().indexOf(">")>-1)&&(e.f=c,e.block=o,e.htmlState=null),n}function s(t,e){if(t.sol()&&t.match(/^```/,!0)){e.localMode=e.localState=null,e.f=c,e.block=o,n.highlightFormatting&&(e.formatting="code-block"),e.code=!0;var i=h(e);return e.code=!1,i}return e.localMode?e.localMode.token(t,e.localState):(t.skipToEnd(),q)}function h(t){var e=[];if(t.formatting){e.push(B),"string"==typeof t.formatting&&(t.formatting=[t.formatting]);for(var i=0;i<t.formatting.length;i++)e.push(B+"-"+t.formatting[i]),"header"===t.formatting[i]&&e.push(B+"-"+t.formatting[i]+"-"+t.header),"quote"===t.formatting[i]&&(!n.maxBlockquoteDepth||n.maxBlockquoteDepth>=t.quote?e.push(B+"-"+t.formatting[i]+"-"+t.quote):e.push("error"))}if(t.taskOpen)return e.push("meta"),e.length?e.join(" "):null;if(t.taskClosed)return e.push("property"),e.length?e.join(" "):null;if(t.linkHref)return e.push(E),e.length?e.join(" "):null;if(t.strong&&e.push(O),t.em&&e.push(N),t.linkText&&e.push($),t.code&&e.push(q),t.header&&(e.push(M),e.push(M+"-"+t.header)),t.quote&&(e.push(w),!n.maxBlockquoteDepth||n.maxBlockquoteDepth>=t.quote?e.push(w+"-"+t.quote):e.push(w+"-"+n.maxBlockquoteDepth)),!1!==t.list){var r=(t.listDepth-1)%3;r?1===r?e.push(D):e.push(H):e.push(C)}return t.trailingSpaceNewLine?e.push("trailing-space-new-line"):t.trailingSpace&&e.push("trailing-space-"+(t.trailingSpace%2?"a":"b")),e.length?e.join(" "):null}function f(t,e){if(t.match(z,!0))return h(e)}function c(e,i){var a=i.text(e,i);if(void 0!==a)return a;if(i.list)return i.list=null,h(i);if(i.taskList)return"x"!==e.match(U,!0)[1]?i.taskOpen=!0:i.taskClosed=!0,n.highlightFormatting&&(i.formatting="task"),i.taskList=!1,h(i);if(i.taskOpen=!1,i.taskClosed=!1,i.header&&e.match(/^#+$/,!0))return n.highlightFormatting&&(i.formatting="header"),h(i);var o=e.sol(),s=e.next();if(i.escape)return i.escape=!1,h(i);if("\\"===s)return n.highlightFormatting&&(i.formatting="escape"),i.escape=!0,h(i);if(i.linkTitle){i.linkTitle=!1;var f=s;"("===s&&(f=")");var c="^\\s*(?:[^"+(f=(f+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"))+"\\\\]+|\\\\\\\\|\\\\.)"+f;if(e.match(new RegExp(c),!0))return E}if("`"===s){var u=i.formatting;n.highlightFormatting&&(i.formatting="code");var d=h(i),p=e.pos;e.eatWhile("`");var k=1+e.pos-p;return i.code?k===F?(i.code=!1,d):(i.formatting=u,h(i)):(F=k,i.code=!0,h(i))}if(i.code)return h(i);if("!"===s&&e.match(/\[[^\]]*\] ?(?:\(|\[)/,!1))return e.match(/\[[^\]]*\]/),i.inline=i.f=g,y;if("["===s&&e.match(/.*\](\(| ?\[)/,!1))return i.linkText=!0,n.highlightFormatting&&(i.formatting="link"),h(i);if("]"===s&&i.linkText){n.highlightFormatting&&(i.formatting="link");var x=h(i);return i.linkText=!1,i.inline=i.f=g,x}if("<"===s&&e.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,!1))return i.f=i.inline=m,n.highlightFormatting&&(i.formatting="link"),(x=h(i))?x+=" ":x="",x+j;if("<"===s&&e.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,!1))return i.f=i.inline=m,n.highlightFormatting&&(i.formatting="link"),(x=h(i))?x+=" ":x="",x+_;if("<"===s&&e.match(/^\w/,!1)){if(-1!=e.string.indexOf(">")){var v=e.string.substring(1,e.string.indexOf(">"));/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(v)&&(i.md_inside=!0)}return e.backUp(1),i.htmlState=t.startState(S),r(e,i,l)}if("<"===s&&e.match(/^\/\w*?>/))return i.md_inside=!1,"tag";var L=!1;if(!n.underscoresBreakWords&&"_"===s&&"_"!==e.peek()&&e.match(/(\w)/,!1)){var b=e.pos-2;if(b>=0){var M=e.string.charAt(b);"_"!==M&&M.match(/(\w)/,!1)&&(L=!0)}}if("*"===s||"_"===s&&!L)if(o&&" "===e.peek());else{if(i.strong===s&&e.eat(s)){n.highlightFormatting&&(i.formatting="strong");d=h(i);return i.strong=!1,d}if(!i.strong&&e.eat(s))return i.strong=s,n.highlightFormatting&&(i.formatting="strong"),h(i);if(i.em===s){n.highlightFormatting&&(i.formatting="em");d=h(i);return i.em=!1,d}if(!i.em)return i.em=s,n.highlightFormatting&&(i.formatting="em"),h(i)}else if(" "===s&&(e.eat("*")||e.eat("_"))){if(" "===e.peek())return h(i);e.backUp(1)}return" "===s&&(e.match(/ +$/,!1)?i.trailingSpace++:i.trailingSpace&&(i.trailingSpaceNewLine=!0)),h(i)}function m(t,e){if(">"===t.next()){e.f=e.inline=c,n.highlightFormatting&&(e.formatting="link");var i=h(e);return i?i+=" ":i="",i+j}return t.match(/^[^>]+/,!0),j}function g(t,e){if(t.eatSpace())return null;var i=t.next();return"("===i||"["===i?(e.f=e.inline=u("("===i?")":"]"),n.highlightFormatting&&(e.formatting="link-string"),e.linkHref=!0,h(e)):"error"}function u(t){return function(e,i){if(e.next()===t){i.f=i.inline=c,n.highlightFormatting&&(i.formatting="link-string");var r=h(i);return i.linkHref=!1,r}return e.match(x(t),!0)&&e.backUp(1),i.linkHref=!0,h(i)}}function d(t,e){return t.match(/^[^\]]*\]:/,!1)?(e.f=p,t.next(),n.highlightFormatting&&(e.formatting="link"),e.linkText=!0,h(e)):i(t,e,c)}function p(t,e){if(t.match(/^\]:/,!0)){e.f=e.inline=k,n.highlightFormatting&&(e.formatting="link");var i=h(e);return e.linkText=!1,i}return t.match(/^[^\]]+/,!0),$}function k(t,e){return t.eatSpace()?null:(t.match(/^[^\s]+/,!0),void 0===t.peek()?e.linkTitle=!0:t.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,!0),e.f=e.inline=c,E)}function x(t){return G[t]||(t=(t+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),G[t]=new RegExp("^(?:[^\\\\]|\\\\.)*?("+t+")")),G[t]}var v=t.modes.hasOwnProperty("xml"),S=t.getMode(e,v?{name:"xml",htmlMode:!0}:"text/plain"),L={html:"htmlmixed",js:"javascript",json:"application/json",c:"text/x-csrc","c++":"text/x-c++src",java:"text/x-java",csharp:"text/x-csharp","c#":"text/x-csharp",scala:"text/x-scala"},b=function(){var n,i={},r={},a=[];for(var o in t.modes)t.modes.propertyIsEnumerable(o)&&a.push(o);for(n=0;n<a.length;n++)i[a[n]]=a[n];var l=[];for(var o in t.mimeModes)t.mimeModes.propertyIsEnumerable(o)&&l.push({mime:o,mode:t.mimeModes[o]});for(n=0;n<l.length;n++)r[l[n].mime]=l[n].mime;for(var s in L)(L[s]in i||L[s]in r)&&(i[s]=L[s]);return function(n){return i[n]?t.getMode(e,i[n]):null}}();void 0===n.highlightFormatting&&(n.highlightFormatting=!1),void 0===n.maxBlockquoteDepth&&(n.maxBlockquoteDepth=0),void 0===n.underscoresBreakWords&&(n.underscoresBreakWords=!0),void 0===n.fencedCodeBlocks&&(n.fencedCodeBlocks=!1),void 0===n.taskLists&&(n.taskLists=!1);var F=0,M="header",q="comment",w="quote",C="variable-2",D="variable-3",H="keyword",T="hr",y="tag",B="formatting",j="link",_="link",$="link",E="string",N="em",O="strong",W=/^([*\-=_])(?:\s*\1){2,}\s*$/,I=/^[*\-+]\s+/,R=/^[0-9]+\.\s+/,U=/^\[(x| )\](?=\s)/,A=/^#+/,P=/^(?:\={1,}|-{1,})$/,z=/^[^#!\[\]*_\\<>` "'(]+/,G=[],J={startState:function(){return{f:o,prevLineHasContent:!1,thisLineHasContent:!1,block:o,htmlState:null,indentation:0,inline:c,text:f,escape:!1,formatting:!1,linkText:!1,linkHref:!1,linkTitle:!1,em:!1,strong:!1,header:0,taskList:!1,list:!1,listDepth:0,quote:0,trailingSpace:0,trailingSpaceNewLine:!1}},copyState:function(e){return{f:e.f,prevLineHasContent:e.prevLineHasContent,thisLineHasContent:e.thisLineHasContent,block:e.block,htmlState:e.htmlState&&t.copyState(S,e.htmlState),indentation:e.indentation,localMode:e.localMode,localState:e.localMode?t.copyState(e.localMode,e.localState):null,inline:e.inline,text:e.text,escape:!1,formatting:!1,linkTitle:e.linkTitle,em:e.em,strong:e.strong,header:e.header,taskList:e.taskList,list:e.list,listDepth:e.listDepth,quote:e.quote,trailingSpace:e.trailingSpace,trailingSpaceNewLine:e.trailingSpaceNewLine,md_inside:e.md_inside}},token:function(t,e){if(e.formatting=!1,t.sol()){var n=t.match(/^\s*$/,!0)||e.header;if(e.header=0,n)return e.prevLineHasContent=!1,a(e);e.prevLineHasContent=e.thisLineHasContent,e.thisLineHasContent=!0,e.escape=!1,e.taskList=!1,e.code=!1,e.trailingSpace=0,e.trailingSpaceNewLine=!1,e.f=e.block;var i=t.match(/^\s*/,!0)[0].replace(/\t/g,"    ").length,r=4*Math.floor((i-e.indentation)/4);r>4&&(r=4);var o=e.indentation+r;if(e.indentationDiff=o-e.indentation,e.indentation=o,i>0)return null}var l=e.f(t,e);return t.start==t.pos?this.token(t,e):l},innerMode:function(t){return t.block==l?{state:t.htmlState,mode:S}:t.localState?{state:t.localState,mode:t.localMode}:{state:t,mode:J}},blankLine:a,getType:h,fold:"markdown"};return J},"xml"),t.defineMIME("text/x-markdown","markdown")});